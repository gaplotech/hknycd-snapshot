<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>2020香港除夕倒數大抽獎</title>
    <link rel="stylesheet" href="css/main.css">
    <script src="js/main.js"></script>
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/url-search-params-polyfill-master/index.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-155005261-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-155005261-1');
    </script>
    <!-- 
    Start of global snippet: Please do not remove
    Place this snippet between the <head> and </head> tags on every page of your site.
    -->
    <!-- Global site tag (gtag.js) - Google Marketing Platform -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=DC-2640398"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'DC-2640398');
    </script>
    <!-- End of global snippet: Please do not remove -->
    <!--
    Event snippet for 2019 NYCD - 05A - HK Citizen - Card Game - Thank You Page on : Please do not remove.
    Place this snippet on pages with events that you’re tracking. 
    Creation date: 12/26/2019
    -->
    <script>
    gtag('event', 'conversion', {
      'allow_custom_scripts': true,
      'send_to': 'DC-2640398/2019n0/2019n006+standard'
    });
  </script>
  <noscript>
  <img src="https://ad.doubleclick.net/ddm/activity/src=2640398;type=2019n0;cat=2019n006;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;tfua=;npa=;ord=1?" width="1" height="1" alt=""/>
  </noscript>
  <!-- End of event snippet: Please do not remove -->
</head>
<body class="page-game-successful-with-coupon">
<div id="mask-wrapper"></div>
<div class="site-content">
    <div class="background"></div>
    <header>
        <div class="language-side">
            <div class="language">
                <a href="../en" class="en lang">ENG</a>
            </div>
        </div>
        <div class="logo-side">
            <div class="left-side">
                <div class="sponsor1 sponsor"><img src="images/TB2020_Sponsor_chi_1.png" alt=""></div>
                <div class="sponsor2 sponsor"><img src="images/TB2020_Sponsor_chi_2.png" alt=""></div>
            </div>
            <div class="right-side">
                <div class="sponsor3 sponsor"><img src="images/TB2020_Sponsor_chi_3-tb.png" alt=""></div>
                <div class="sponsor4 sponsor"><img src="images/TB2020_Sponsor_chi_3-dragon.png" alt=""></div>
            </div>
        </div>
    </header>
    <div class="container">
        <a href="../zh-Hant" class="lucky-draw-logo small layout1"></a>
        <div class="box layout1">
            <div class="detail">
                <div class="card-game-title"></div>
                <h2> 立即配對！即有機會贏取現金券！</h2>
            </div><div class="voucher"></div>
            <div class="description">
                點擊卡片翻牌，將地標圖片與地區名稱配成一組。成功完成挑戰後，系統將隨機送出港幣$100超市現金券。
            </div>
            <div class="voucher-desktop">
                <img src="images/TB2020_icon_voucher.png" alt="">
            </div>
            <a href="../zh-Hant" class="back-to-home-btn">返回主頁</a>
        </div>
        <div class="box style2">
            <img src="images/TB2020_txt_game.png" alt="">
            <div class="success-message">
                挑戰成功
            </div>
            <div class="got-coupon-message">
                <p>恭喜你！</p>
                <p>你已抽中港幣$100 超市現金券！</p>
            </div>
            <div class="voucher"></div>
            <div class="send-to-mobile-remind-message">領獎詳情將於72小時內發送至你的電郵地址。<div>你的得獎編號為：</div></div>
            <div class="prize-number-message">
                <span>Loading...</span>
            </div>
            <a href="luckydraw-successful.html" class="join-luckydraw-btn button blue">登記參加壓軸大抽獎</a>
        </div>
        <div class="content">
            <a href="../zh-Hant" class="lucky-draw-logo small"></a>
            <div class="box">
                <div class="detail">
                    <div class="card-game-title"></div>
                    <h2> 立即配對！即有機會贏取現金券！</h2>
                </div><div class="voucher"></div>
                <div class="description">
                    點擊卡片翻牌，將地標圖片與地區名稱配成一組。成功完成挑戰後，系統將隨機送出港幣$100超市現金券。
                </div>
                <div class="voucher-desktop">
                    <img src="images/TB2020_icon_voucher.png" alt="">
                </div>
                <a href="../zh-Hant" class="back-to-home-btn">返回主頁</a>
            </div>
        </div>
    </div>
    <div class="promotion-code">
        推廣生意的競賽牌照號碼: 53010-11
    </div>
    <div id="g-recaptcha-card-game-check" data-size="invisible"></div>
</div>
<script type="text/javascript">
    

    var couponConfirmationCode = localToken.get();

    $(document).ready(function() {
        if (getCookie('access_token') == null) {
            $('#mask-wrapper').show();
            window.location.href = 'card-game-register.html';
            return;
        }

        if (couponConfirmationCode) {
            $('#mask-wrapper').hide();
            localToken.set(couponConfirmationCode);
            // Display coupon code number
            $('.prize-number-message > span').text(couponConfirmationCode);
        }
    });

    function showCardGameCheckRecaptchaWidget() {
        try {
            //grecaptcha.reset(cardGameCheckRecaptchaWidget);
            //grecaptcha.execute(cardGameCheckRecaptchaWidget);
        }
        catch(error) {
        }
    }

    function onCardGameCheck(token) {
        try {
            //grecaptcha.reset(cardGameCheckRecaptchaWidget);
        }
        catch(error) {
        }

        if(getCookie('access_token') == null) {
            $('#mask-wrapper').show();
            window.location.href = 'card-game-register.html';
            return;
        }

        var requestLang = 1;
        $('#mask-wrapper').show();
        $.ajax({
            type: 'POST',
            dataType: 'json', cache: false,
            url: config.endpoint + '/v1/card-game-check',
            data: {
                lang: requestLang,
                token: token
            },
            beforeSend: function (xhr) {
                xhr.setRequestHeader('Authorization', 'Bearer ' + getCookie('access_token'));
            },
            complete: function (XMLHttpRequest, textStatus) {
                try {
                    //grecaptcha.reset(cardGameCheckRecaptchaWidget);
                }
                catch(error) {
                }
            },
            success: function (data) {
                if (data.status == 'success' && typeof (data.detail) == 'string' && data.detail.length > 0) {
                    $('#mask-wrapper').hide();
                    localToken.set(data.detail);
                    // Display coupon code number
                    $('.prize-number-message > span').text(data.detail);
                }
                else {
                    window.location.href = 'card-game.html';
                }
            },
            error: function (data) {
                if (data && data.status >= 500) {
  window.location.href = 'system-busy.html';
}
            },
            statusCode: {
                400: function (data) {
                    var errorMessage = '';

                    $.each(data.responseJSON.detail, function (key, value) {
                        errorMessage += value;
                        errorMessage += '\n';
                    });

                    alert(errorMessage);
                    $('#mask-wrapper').hide();
                },
                401: function () {
                    localStorage.removeItem('access_token');
                    window.location.href = '/zh-Hant';
                },
                403: function (data) {
                    // 403 redirection to login page
                    window.location.href = 'luckydraw-register.html';
                }
            }
        });
    }

    var cardGameCheckRecaptchaWidget = null;
    var onloadRecaptchaCallback = function() {
        /*
        cardGameCheckRecaptchaWidget = grecaptcha.render('g-recaptcha-card-game-check', {
          sitekey: '6Ldro8kUAAAAAFKNs0AIODd7RnzLkhWE6evNltmA',
          callback: onCardGameCheck
        });
        //grecaptcha.reset(cardGameCheckRecaptchaWidget);
        */

        if(!couponConfirmationCode) {
        // Fetch the coupon code from endpoint if param is not present

        // showCardGameCheckRecaptchaWidget();
        onCardGameCheck('88recaptcha');
        }
    };
</script>
<script src="https://www.google.com/recaptcha/api.js?onload=onloadRecaptchaCallback&render=explicit"></script>
</body>
</html>